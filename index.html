<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Engineering Tools Catalog</title>
    <style>
      :root {
        --bg: #f8f9fa;
        --card: #ffffff;
        --text: #1f2933;
        --muted: #52606d;
        --accent: #2563eb;
        --border: #d2d6dc;
        --radius: 12px;
        font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont,
          "Helvetica Neue", Arial, sans-serif;
      }

      body {
        margin: 0;
        padding: 0;
        background: var(--bg);
        color: var(--text);
        min-height: 100vh;
      }

      header {
        padding: 3.5rem 1.5rem 2rem;
        text-align: center;
        background: linear-gradient(135deg, #e0f2fe, #eff6ff);
        border-bottom: 1px solid var(--border);
      }

      header h1 {
        margin: 0;
        font-size: clamp(2rem, 4vw, 3rem);
      }

      header p {
        margin: 1rem auto 0;
        max-width: 720px;
        color: var(--muted);
        font-size: 1.05rem;
        line-height: 1.6;
      }

      main {
        max-width: 1100px;
        margin: 0 auto;
        padding: 2rem 1.5rem 4rem;
      }

      .controls {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
      }

      .control {
        display: flex;
        flex-direction: column;
      }

      .control label {
        font-weight: 600;
        margin-bottom: 0.4rem;
        color: var(--muted);
      }

      .control input[type="search"],
      .control select {
        padding: 0.7rem 0.9rem;
        border-radius: var(--radius);
        border: 1px solid var(--border);
        font-size: 1rem;
        transition: border-color 0.2s, box-shadow 0.2s;
      }

      .control input[type="search"]:focus,
      .control select:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
        outline: none;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 1.5rem;
      }

      .card {
        background: var(--card);
        border-radius: var(--radius);
        border: 1px solid #e4e7eb;
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        box-shadow: 0 12px 25px -18px rgba(15, 23, 42, 0.45);
        transition: transform 0.18s ease, box-shadow 0.18s ease;
      }

      .card:hover {
        transform: translateY(-4px);
        box-shadow: 0 18px 32px -16px rgba(15, 23, 42, 0.3);
      }

      .card h2 {
        margin: 0;
        font-size: 1.2rem;
      }

      .card p {
        margin: 0;
        color: var(--muted);
        line-height: 1.5;
      }

      .card .meta {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        font-size: 0.9rem;
        color: var(--muted);
      }

      .badge {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        border-radius: 999px;
        padding: 0.25rem 0.65rem;
        background: #eff6ff;
        color: #1d4ed8;
        font-weight: 600;
        font-size: 0.85rem;
      }

      .tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.4rem;
      }

      .tag {
        background: #f3f4f6;
        color: var(--muted);
        padding: 0.2rem 0.55rem;
        border-radius: 999px;
        font-size: 0.78rem;
        letter-spacing: 0.02em;
      }

      .card a {
        margin-top: auto;
        align-self: flex-start;
        padding: 0.55rem 0.9rem;
        background: var(--accent);
        color: #fff;
        border-radius: var(--radius);
        text-decoration: none;
        font-weight: 600;
        transition: background 0.18s ease;
      }

      .card a:hover {
        background: #1d4ed8;
      }

      .empty-state {
        text-align: center;
        padding: 3rem 1rem;
        color: var(--muted);
        border: 2px dashed var(--border);
        border-radius: var(--radius);
        background: rgba(255, 255, 255, 0.55);
      }

      footer {
        text-align: center;
        padding: 2rem 1rem 3rem;
        color: var(--muted);
        font-size: 0.9rem;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Engineering Tools Catalog</h1>
      <p>
        Browse calculators, visualizers, and reference utilities powered by
        Pyodide. Use the filters below to quickly surface the discipline or
        topic you need.
      </p>
    </header>

    <main>
      <section class="controls">
        <div class="control">
          <label for="search">Search</label>
          <input
            type="search"
            id="search"
            placeholder="Search by name, description, or tags..."
            autocomplete="off"
          />
        </div>
        <div class="control">
          <label for="category">Category</label>
          <select id="category">
            <option value="all">All categories</option>
          </select>
        </div>
      </section>

      <section id="tool-grid" class="grid" aria-live="polite"></section>

      <div id="empty-state" class="empty-state" style="display: none;">
        <h2>No tools match your filters</h2>
        <p>Try broadening your search or resetting the category filter.</p>
      </div>
    </main>

    <footer>
      &copy; <span id="year"></span> Engineering Tools. Built for learning and
      rapid engineering trade studies.
    </footer>

    <script>
      const searchInput = document.getElementById("search");
      const categorySelect = document.getElementById("category");
      const grid = document.getElementById("tool-grid");
      const emptyState = document.getElementById("empty-state");
      const year = document.getElementById("year");

      let tools = [];

      year.textContent = new Date().getFullYear();

      async function loadTools() {
        try {
          const response = await fetch("./_catalog.json");
          if (!response.ok) throw new Error("Failed to load catalog");
          tools = await response.json();
          renderCategoryFilter(tools);
          renderTools(tools);
        } catch (error) {
          console.error(error);
          grid.innerHTML =
            "<div class='empty-state'><h2>Unable to load catalog</h2><p>Check the console for details.</p></div>";
        }
      }

      function renderCategoryFilter(toolList) {
        const categories = new Set();
        toolList.forEach((tool) => {
          (tool.category || []).forEach((cat) => categories.add(cat));
        });

        const sorted = Array.from(categories).sort((a, b) =>
          a.localeCompare(b)
        );
        sorted.forEach((cat) => {
          const option = document.createElement("option");
          option.value = cat;
          option.textContent = cat;
          categorySelect.appendChild(option);
        });
      }

      function renderTools(toolList) {
        grid.innerHTML = "";

        if (!toolList.length) {
          grid.style.display = "none";
          emptyState.style.display = "block";
          return;
        }

        grid.style.display = "grid";
        emptyState.style.display = "none";

        toolList.forEach((tool) => {
          const card = document.createElement("article");
          card.className = "card";

          const title = document.createElement("h2");
          title.textContent = tool.title;
          card.appendChild(title);

          const description = document.createElement("p");
          description.textContent = tool.description;
          card.appendChild(description);

          if (tool.category?.length) {
            const meta = document.createElement("div");
            meta.className = "meta";
            tool.category.forEach((cat) => {
              const badge = document.createElement("span");
              badge.className = "badge";
              badge.textContent = cat;
              meta.appendChild(badge);
            });
            card.appendChild(meta);
          }

          if (tool.tags?.length) {
            const tagsContainer = document.createElement("div");
            tagsContainer.className = "tags";
            tool.tags.forEach((tag) => {
              const tagEl = document.createElement("span");
              tagEl.className = "tag";
              tagEl.textContent = tag;
              tagsContainer.appendChild(tagEl);
            });
            card.appendChild(tagsContainer);
          }

          const link = document.createElement("a");
          link.href = tool.path;
          link.textContent = "Open Tool";
          link.setAttribute("aria-label", `Open ${tool.title}`);
          card.appendChild(link);

          grid.appendChild(card);
        });
      }

      function applyFilters() {
        const query = searchInput.value.trim().toLowerCase();
        const category = categorySelect.value;

        const filtered = tools.filter((tool) => {
          const matchesCategory =
            category === "all" ||
            (tool.category || []).some(
              (cat) => cat.toLowerCase() === category.toLowerCase()
            );

          const haystack = [
            tool.title,
            tool.description,
            ...(tool.tags || []),
            ...(tool.category || []),
          ]
            .join(" ")
            .toLowerCase();

          const matchesQuery = !query || haystack.includes(query);
          return matchesCategory && matchesQuery;
        });

        renderTools(filtered);
      }

      searchInput.addEventListener("input", applyFilters);
      categorySelect.addEventListener("change", applyFilters);

      loadTools();
    </script>
  </body>
</html>
